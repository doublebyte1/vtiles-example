<html>
<head><title>OGC API - Tiles Styling</title></head>
<body>
<div id="map" style="width:100vw;height:100vh;"></div>

    <!-- load leaflet -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
        integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A=="
        crossorigin="" />
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"
        integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA=="
        crossorigin=""></script>

    <!-- load VectorGrid extension -->
    <script src="https://unpkg.com/leaflet.vectorgrid@1.3.0/dist/Leaflet.VectorGrid.bundled.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/github-fork-ribbon-css/0.2.3/gh-fork-ribbon.min.css" />

<script>


map = L.map('map').setView({ lat: 58.37, lng: 26.72 }, 7);
map.addLayer(
    new L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Base/MapServer/tile/{z}/{y}/{x}', {
	attribution: 'Tiles &copy; Esri &mdash; Esri, DeLorme, NAVTEQ',
    minZoom: 1,
    maxZoom: 16
    }));

function getColor(val){
    return val < 0 ? "#DAF7A6":
               val < 400 ? "#FFC300":
               val < 1500 ? "#FF5733":
               val < 3000 ? "#C70039":
               "#900C3F";
}

var vectorTileStyling = {
    meta: function(properties) {
        return ({
            fill: false,
            fillColor: "#ffffff",
            fillOpacity: 0.0,
            weight: 1,
            color: "green",
            opacity: 1,
        });
    },
    hits: function(properties) {
        console.log(properties)
        val = properties["properties.visitors"]
        return ({
            fill: true,
            fillColor: getColor(val),
            fillOpacity: 0.7,
            weight: 1,
            color: "#B29071",
            opacity: 1,
        });
    }
}

var mapVectorTileOptions = {
    rendererFactory: L.canvas.tile,
    interactive: true,
    vectorTileLayerStyles: vectorTileStyling,
};

var pbfURL='http://localhost:5000/collections/bathingwater-estonia/tiles/WebMercatorQuad/{z}/{x}/{y}?f=mvt';
    var pbfLayer=L.vectorGrid.protobuf(pbfURL,mapVectorTileOptions).addTo(map); 

    
</script>
</body>
</html>